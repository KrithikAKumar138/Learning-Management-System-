<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${course.title}">Course Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 font-sans">

<div class="h-[60px] bg-indigo-600 text-white flex items-center justify-between px-6 shadow-md">
    <strong class="text-lg font-semibold" th:text="${course.title}"></strong>
    <a href="/student/courses"
       class="text-sm font-medium hover:underline">
        ‚¨Ö Back
    </a>
</div>


<div class="flex h-[calc(100vh-60px)]">

    <aside class="w-[260px] bg-white border-r border-gray-200 p-5 overflow-y-auto">

        <div class="mb-6">
            <strong class="text-sm text-gray-700">Course Progress</strong>

            <div class="w-full h-2 bg-gray-200 rounded-full mt-2">
                <div class="h-2 bg-indigo-600 rounded-full transition-all"
                     th:style="'width:' + ${enrollment.progress} + '%'">
                </div>
            </div>

            <small class="text-xs text-gray-500"
                   th:text="${enrollment.progress + '% Completed'}"></small>
        </div>

        <h3 class="text-lg font-semibold mb-4 text-gray-700">Lessons</h3>

        <a th:each="lesson : ${lessons}"
           th:href="@{/student/course/{cid}(cid=${course.id}, lessonId=${lesson.id})}"
           class="flex items-center justify-between px-3 py-2 mb-2 rounded-md
                  text-sm transition"
           th:classappend="${lesson.id == currentLesson.id}
             ? 'bg-indigo-600 text-white font-semibold'
             : 'text-gray-700 hover:bg-indigo-50'">

            <span th:text="${lesson.title}"></span>

            <span th:if="${enrollment.completedLessonIds.contains(lesson.id)}"
                  class="text-green-500 font-bold">
                ‚úî
            </span>
        </a>


        <a th:href="@{/student/quiz/{courseId}(courseId=${course.id})}"
           class="flex items-center justify-between px-3 py-2 rounded-md
          text-sm mt-2 text-gray-700 hover:bg-indigo-50">

            üìù Quiz
        </a>


    </aside>

    <main class="flex-1 bg-black text-white p-8 overflow-y-auto">

        <h2 class="text-2xl font-semibold mb-6"
            th:text="${currentLesson.title}"></h2>

        <!-- VIDEO -->
        <div th:if="${currentLesson.contentType == 'VIDEO'}">
            <video controls
                   class="w-full h-[500px] rounded-lg bg-black shadow-lg">
                <source th:src="${currentLesson.filePath}">

            </video>
        </div>


        <div th:if="${currentLesson.contentType == 'PDF'}">
            <iframe
                    class="w-full h-[500px] rounded-lg bg-black shadow-lg"
                    th:src="${currentLesson.filePath}">
            </iframe>
        </div>

        <div th:if="${currentLesson.contentType == 'TEXT'}">
            <pre class="whitespace-pre-wrap text-base bg-zinc-900 p-5 rounded-lg shadow-inner"
                 th:text="${currentLesson.content}">
            </pre>
        </div>


        <div th:if="${currentLesson.contentType == 'FILE'}">
            <a th:href="${currentLesson.filePath}"
               target="_blank"
               class="inline-block mt-4 px-6 py-3 bg-indigo-600 rounded-md
                      text-white font-medium hover:bg-indigo-500 transition">
                Download File
            </a>
        </div>

        <div class="flex justify-end mt-8">
            <form th:action="@{/student/lesson/complete/{lessonId}(lessonId=${currentLesson.id})}"
                  method="post">

                <input type="hidden" name="courseId"
                       th:value="${course.id}" />

                <button type="submit"
                        th:disabled="${enrollment.completedLessonIds.contains(currentLesson.id)}"
                        th:text="${enrollment.completedLessonIds.contains(currentLesson.id)}
                          ? '‚úî Lesson Completed'
                          : '‚úî Mark Lesson Completed'"
                        class="px-6 py-3 rounded-md font-medium text-white transition
                               bg-green-500 hover:bg-green-600
                               disabled:bg-gray-400 disabled:cursor-not-allowed">
                </button>
            </form>
        </div>

    </main>
</div>

</body>
</html>
